// OAuth 2.0 code flow
Flow agama.inbound.oauth2.authzCode
     Basepath ""
     Inputs oauthParams
When oauthParams.redirectUri is null
     // Obtain hostname from HTTP url
     issuer = Call io.jans.util.NetworkUtils#urlBeforeContextPath  
     // assign redirect url 
     list = [issuer, "/jans-auth/fl/callback"]
     // Build redirect uri
     oauthParams.redirectUri = Call java.lang.String#join "" list
// Instantiate code grant utility
codeGrantUtil = Call io.jans.inbound.oauth2.CodeGrantUtil#new oauthParams
// authorization request
Log "@info Creating an authorization request"
// generate authorization request
url = Call codeGrantUtil makeAuthzRequest  
// Extract url and generated state
state = url.second
url = url.first
// redirect to hello.coop
Log "@info Redirecting to hello.coop for social login"
// Redirect to External OP
responsePramas = RFAC url
// received response from external OP
Log "@info Browser taken back to redirect Uri"
// Parse code presented at callback uri
code = Call codeGrantUtil parseCode responseParams state
// Grab token response variable looks like in sect 4.1.4 of RFC 6749
response = Call codeGrantUtil getTokenResponse code
// log
Log "@info Access token has been obtained"
// assigned response data
obj = { success: true, data: response }
it_tuifo = { success: true, data: { userId: "as9233Qz" } }
Finish it_tuifo